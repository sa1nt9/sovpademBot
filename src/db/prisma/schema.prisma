generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model User {
    id             String   @id // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
    name           String
    city           String
    longitude      Float
    latitude       Float
    age            Int
    gender         Gender
    ownCoordinates Boolean  @default(false) // –ú–æ–∂–µ—Ç –±—ã—Ç—å null
    createdAt      DateTime @default(now()) // –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
    isActive       Boolean  @default(true) // –ê–∫—Ç–∏–≤–Ω–∞ –ª–∏ –∞–Ω–∫–µ—Ç–∞
    referrerId     String? // ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–≥–ª–∞—Å–∏–ª

    // –¢–∏–ø—ã –∞–Ω–∫–µ—Ç
    relationshipProfile RelationshipProfile?
    sportProfiles       SportProfile[]
    gameProfiles        GameProfile[]
    hobbyProfiles       HobbyProfile[]
    itProfiles          ITProfile[]
    travelProfile       TravelProfile?

    reports    Report[] @relation("UserReports")
    reportedBy Report[] @relation("UserReported")

    rouletteUser RouletteUser?

    // –°–≤—è–∑–∏ –¥–ª—è —á–µ—Ä–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞
    blacklist     Blacklist[] @relation("UserBlacklist")
    blacklistedBy Blacklist[] @relation("BlacklistedBy")
}

// –û—Å–Ω–æ–≤–Ω–æ–π —Ç–∏–ø –∞–Ω–∫–µ—Ç—ã (–æ—Ç–Ω–æ—à–µ–Ω–∏—è)
model RelationshipProfile {
    id           String       @id @default(uuid())
    userId       String       @unique
    interestedIn InterestedIn
    description  String
    files        Json // –ú–∞—Å—Å–∏–≤ —Ñ–∞–π–ª–æ–≤ –≤ JSON
    isActive     Boolean      @default(true)
    createdAt    DateTime     @default(now())
    updatedAt    DateTime     @updatedAt

    user User @relation(fields: [userId], references: [id], onDelete: Cascade)

    // –õ–∞–π–∫–∏ –¥–ª—è –ø—Ä–æ—Ñ–∏–ª—è –æ—Ç–Ω–æ—à–µ–Ω–∏–π
    likesGiven    ProfileLike[] @relation("RelationshipProfileLikes")
    likesReceived ProfileLike[] @relation("RelationshipProfileLiked")
}

// –°–ø–æ—Ä—Ç–∏–≤–Ω–∞—è –∞–Ω–∫–µ—Ç–∞
model SportProfile {
    id          String    @id @default(uuid())
    userId      String
    sportType   SportType
    level       String? // –£—Ä–æ–≤–µ–Ω—å –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏
    description String
    files       Json // –ú–∞—Å—Å–∏–≤ —Ñ–∞–π–ª–æ–≤ –≤ JSON 
    isActive    Boolean   @default(true)
    createdAt   DateTime  @default(now())
    updatedAt   DateTime  @updatedAt

    user User @relation(fields: [userId], references: [id], onDelete: Cascade)

    // –õ–∞–π–∫–∏ –¥–ª—è —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π
    likesGiven    ProfileLike[] @relation("SportProfileLikes")
    likesReceived ProfileLike[] @relation("SportProfileLiked")

    @@unique([userId, sportType]) // –û–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –ø—Ä–æ—Ñ–∏–ª—å –∫–∞–∂–¥–æ–≥–æ —Å–ø–æ—Ä—Ç–∏–≤–Ω–æ–≥–æ —Ç–∏–ø–∞
}

// –ò–≥—Ä–æ–≤–∞—è –∞–Ω–∫–µ—Ç–∞
model GameProfile {
    id          String   @id @default(uuid())
    userId      String
    gameType    GameType
    rank        String? // –†–∞–Ω–≥/—É—Ä–æ–≤–µ–Ω—å
    accountLink String? // –°—Å—ã–ª–∫–∞ –Ω–∞ –∞–∫–∫–∞—É–Ω—Ç
    description String
    files       Json // –ú–∞—Å—Å–∏–≤ —Ñ–∞–π–ª–æ–≤ –≤ JSON
    isActive    Boolean  @default(true)
    createdAt   DateTime @default(now())
    updatedAt   DateTime @updatedAt

    user User @relation(fields: [userId], references: [id], onDelete: Cascade)

    // –õ–∞–π–∫–∏ –¥–ª—è –∏–≥—Ä–æ–≤—ã—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π
    likesGiven    ProfileLike[] @relation("GameProfileLikes")
    likesReceived ProfileLike[] @relation("GameProfileLiked")

    @@unique([userId, gameType]) // –û–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –ø—Ä–æ—Ñ–∏–ª—å –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –∏–≥—Ä—ã
}

// –•–æ–±–±–∏ –∞–Ω–∫–µ—Ç–∞
model HobbyProfile {
    id          String    @id @default(uuid())
    userId      String
    hobbyType   HobbyType
    description String
    files       Json // –ú–∞—Å—Å–∏–≤ —Ñ–∞–π–ª–æ–≤ –≤ JSON
    isActive    Boolean   @default(true)
    createdAt   DateTime  @default(now())
    updatedAt   DateTime  @updatedAt

    user User @relation(fields: [userId], references: [id], onDelete: Cascade)

    // –õ–∞–π–∫–∏ –¥–ª—è —Ö–æ–±–±–∏-–ø—Ä–æ—Ñ–∏–ª–µ–π
    likesGiven    ProfileLike[] @relation("HobbyProfileLikes")
    likesReceived ProfileLike[] @relation("HobbyProfileLiked")

    @@unique([userId, hobbyType]) // –û–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –ø—Ä–æ—Ñ–∏–ª—å –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ —Ö–æ–±–±–∏
}

// IT –∞–Ω–∫–µ—Ç–∞
model ITProfile {
    id            String   @id @default(uuid())
    userId        String
    itType        ITType
    experience    String? // –û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã
    technologies  String? // –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏/—è–∑—ã–∫–∏
    portfolioLink String? // –°—Å—ã–ª–∫–∞ –Ω–∞ GitHub/–ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ
    description   String
    files         Json // –ú–∞—Å—Å–∏–≤ —Ñ–∞–π–ª–æ–≤ –≤ JSON
    isActive      Boolean  @default(true)
    createdAt     DateTime @default(now())
    updatedAt     DateTime @updatedAt

    user User @relation(fields: [userId], references: [id], onDelete: Cascade)

    // –õ–∞–π–∫–∏ –¥–ª—è IT-–ø—Ä–æ—Ñ–∏–ª–µ–π
    likesGiven    ProfileLike[] @relation("ITProfileLikes")
    likesReceived ProfileLike[] @relation("ITProfileLiked")

    @@unique([userId, itType]) // –û–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –ø—Ä–æ—Ñ–∏–ª—å –∫–∞–∂–¥–æ–≥–æ IT —Ç–∏–ø–∞
}

// –ê–Ω–∫–µ—Ç–∞ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π
model TravelProfile {
    id          String   @id @default(uuid())
    userId      String   @unique
    description String
    files       Json // –ú–∞—Å—Å–∏–≤ —Ñ–∞–π–ª–æ–≤ –≤ JSON
    isActive    Boolean  @default(true)
    createdAt   DateTime @default(now())
    updatedAt   DateTime @updatedAt

    user User @relation(fields: [userId], references: [id], onDelete: Cascade)

    // –õ–∞–π–∫–∏ –¥–ª—è –ø—Ä–æ—Ñ–∏–ª–µ–π –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π
    likesGiven    ProfileLike[] @relation("TravelProfileLikes")
    likesReceived ProfileLike[] @relation("TravelProfileLiked")
}

// –û–±—â–∞—è –º–æ–¥–µ–ª—å –ª–∞–π–∫–∞ –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –ø—Ä–æ—Ñ–∏–ª–µ–π
model ProfileLike {
    id              String      @id @default(uuid())
    fromProfileType ProfileType
    fromProfileId   String
    toProfileType   ProfileType
    toProfileId     String
    liked           Boolean // true ‚Äî –ª–∞–π–∫, false ‚Äî –¥–∏–∑–ª–∞–π–∫
    message         String? // –¢–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫ –ª–∞–π–∫—É
    privateNote     String? // –õ–∏—á–Ω–∞—è –∑–∞–º–µ—Ç–∫–∞ –∫ –ª–∞–π–∫—É (–≤–∏–¥–Ω–∞ —Ç–æ–ª—å–∫–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—é)
    videoFileId     String? // ID —Ñ–∞–π–ª–∞ –≤–∏–¥–µ–æ, –µ—Å–ª–∏ –±—ã–ª–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ
    voiceFileId     String?
    videoNoteFileId String?
    isMutual        Boolean     @default(false)
    isMutualAt      DateTime?
    createdAt       DateTime    @default(now())

    // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Å–≤—è–∑–∏ —Å —Ä–∞–∑–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ –ø—Ä–æ—Ñ–∏–ª–µ–π —á–µ—Ä–µ–∑ –ø–æ–ª—è fromProfileType –∏ toProfileType
    relationshipFrom RelationshipProfile? @relation("RelationshipProfileLikes", fields: [fromProfileId], references: [id], onDelete: Cascade, map: "ProfileLike_relationshipFrom_fkey")
    relationshipTo   RelationshipProfile? @relation("RelationshipProfileLiked", fields: [toProfileId], references: [id], onDelete: Cascade, map: "ProfileLike_relationshipTo_fkey")
    sportFrom        SportProfile?        @relation("SportProfileLikes", fields: [fromProfileId], references: [id], onDelete: Cascade, map: "ProfileLike_sportFrom_fkey")
    sportTo          SportProfile?        @relation("SportProfileLiked", fields: [toProfileId], references: [id], onDelete: Cascade, map: "ProfileLike_sportTo_fkey")
    gameFrom         GameProfile?         @relation("GameProfileLikes", fields: [fromProfileId], references: [id], onDelete: Cascade, map: "ProfileLike_gameFrom_fkey")
    gameTo           GameProfile?         @relation("GameProfileLiked", fields: [toProfileId], references: [id], onDelete: Cascade, map: "ProfileLike_gameTo_fkey")
    hobbyFrom        HobbyProfile?        @relation("HobbyProfileLikes", fields: [fromProfileId], references: [id], onDelete: Cascade, map: "ProfileLike_hobbyFrom_fkey")
    hobbyTo          HobbyProfile?        @relation("HobbyProfileLiked", fields: [toProfileId], references: [id], onDelete: Cascade, map: "ProfileLike_hobbyTo_fkey")
    itFrom           ITProfile?           @relation("ITProfileLikes", fields: [fromProfileId], references: [id], onDelete: Cascade, map: "ProfileLike_itFrom_fkey")
    itTo             ITProfile?           @relation("ITProfileLiked", fields: [toProfileId], references: [id], onDelete: Cascade, map: "ProfileLike_itTo_fkey")
    travelFrom       TravelProfile?       @relation("TravelProfileLikes", fields: [fromProfileId], references: [id], onDelete: Cascade, map: "ProfileLike_travelFrom_fkey")
    travelTo         TravelProfile?       @relation("TravelProfileLiked", fields: [toProfileId], references: [id], onDelete: Cascade, map: "ProfileLike_travelTo_fkey")
}

model Session {
    id    Int    @id @default(autoincrement())
    key   String @unique
    value String
}

model Report {
    id         String     @id @default(uuid())
    reporterId String // ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–¥–∞–ª –∂–∞–ª–æ–±—É
    targetId   String // ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–≥–æ –ø–æ–¥–∞–Ω–∞ –∂–∞–ª–æ–±–∞
    type       ReportType // –¢–∏–ø –∂–∞–ª–æ–±—ã
    text       String? // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç –∂–∞–ª–æ–±—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π)
    createdAt  DateTime   @default(now())

    reporter User @relation(name: "UserReports", fields: [reporterId], references: [id], onDelete: Cascade)
    target   User @relation(name: "UserReported", fields: [targetId], references: [id], onDelete: Cascade)
}

enum ReportType {
    other
    sale
    adult_content
    advertising
    scam
    dislike
}

enum Gender {
    male
    female
}

enum InterestedIn {
    male
    female
    all
}

enum ProfileType {
    RELATIONSHIP
    SPORT
    GAME
    HOBBY
    IT
    TRAVEL
}

enum SportType {
    GYM
    RUNNING
    SWIMMING
    FOOTBALL
    BASKETBALL
    TENNIS
    MARTIAL_ARTS
    YOGA
    CYCLING
    CLIMBING
    SKI_SNOWBOARD
}

enum GameType {
    CS_GO
    DOTA2
    VALORANT
    RUST
    MINECRAFT
    LEAGUE_OF_LEGENDS
    FORTNITE
    PUBG
    GTA
    APEX_LEGENDS
    FIFA
    CALL_OF_DUTY
    WOW
    GENSHIN_IMPACT
}

enum HobbyType {
    MUSIC
    DRAWING
    PHOTOGRAPHY
    COOKING
    CRAFTS
    DANCING
    READING
}

enum ITType {
    FRONTEND
    BACKEND
    FULLSTACK
    MOBILE
    DEVOPS
    QA
    DATA_SCIENCE
    GAME_DEV
    CYBERSECURITY
    UI_UX
}

model RouletteUser {
    id               String   @id
    chatPartnerId    String?
    searchingPartner Boolean  @default(true)
    createdAt        DateTime @default(now())
    profileRevealed  Boolean  @default(false)
    usernameRevealed Boolean  @default(false)

    user        User           @relation(fields: [id], references: [id], onDelete: Cascade)
    chatPartner RouletteUser?  @relation("ChatPartners", fields: [chatPartnerId], references: [id])
    partners    RouletteUser[] @relation("ChatPartners")

    // –°–≤—è–∑–∏ –¥–ª—è —Ä–µ–∞–∫—Ü–∏–π
    reactionsGiven    RouletteReaction[] @relation("ReactionGiver")
    reactionsReceived RouletteReaction[] @relation("ReactionReceiver")

    // –°–≤—è–∑–∏ –¥–ª—è —á–∞—Ç–æ–≤
    chatsAsUser1 RouletteChat[] @relation("UserChats1")
    chatsAsUser2 RouletteChat[] @relation("UserChats2")
}

model RouletteReaction {
    id         String       @id @default(uuid())
    fromUserId String // ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–æ—Ç–æ—Ä—ã–π –ø–æ—Å—Ç–∞–≤–∏–ª —Ä–µ–∞–∫—Ü–∏—é
    toUserId   String // ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–æ—Ç–æ—Ä–æ–º—É –ø–æ—Å—Ç–∞–≤–∏–ª–∏ —Ä–µ–∞–∫—Ü–∏—é
    type       ReactionType // –¢–∏–ø —Ä–µ–∞–∫—Ü–∏–∏
    createdAt  DateTime     @default(now())

    fromUser RouletteUser @relation("ReactionGiver", fields: [fromUserId], references: [id], onDelete: Cascade)
    toUser   RouletteUser @relation("ReactionReceiver", fields: [toUserId], references: [id], onDelete: Cascade)
}

enum ReactionType {
    LIKE // üëç
    DISLIKE // üëé
    CLOWN // ü§°
    FUNNY // üòÇ
    BORING // üò¥
    RUDE // üò°
}

model RouletteChat {
    id                 String    @id @default(uuid())
    user1Id            String // ID –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    user2Id            String // ID –≤—Ç–æ—Ä–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    startedAt          DateTime  @default(now())
    endedAt            DateTime? // –í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è —á–∞—Ç–∞ (null –µ—Å–ª–∏ —á–∞—Ç –∞–∫—Ç–∏–≤–µ–Ω)
    isProfileRevealed  Boolean   @default(false) // –ë—ã–ª–∏ –ª–∏ —Ä–∞—Å–∫—Ä—ã—Ç—ã –∞–Ω–∫–µ—Ç—ã
    isUsernameRevealed Boolean   @default(false) // –ë—ã–ª–∏ –ª–∏ —Ä–∞—Å–∫—Ä—ã—Ç—ã Telegram-–ø—Ä–æ—Ñ–∏–ª–∏

    user1 RouletteUser @relation("UserChats1", fields: [user1Id], references: [id], onDelete: Cascade)
    user2 RouletteUser @relation("UserChats2", fields: [user2Id], references: [id], onDelete: Cascade)
}

model Blacklist {
    id        String   @id @default(uuid())
    userId    String // –ö—Ç–æ –¥–æ–±–∞–≤–∏–ª –≤ –ß–°
    targetId  String // –ö–æ–≥–æ –¥–æ–±–∞–≤–∏–ª–∏ –≤ –ß–°
    createdAt DateTime @default(now())

    user   User @relation("UserBlacklist", fields: [userId], references: [id], onDelete: Cascade)
    target User @relation("BlacklistedBy", fields: [targetId], references: [id], onDelete: Cascade)
}
