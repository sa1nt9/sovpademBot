"use strict";var __awaiter=this&&this.__awaiter||function(e,r,a,t){return new(a||(a=Promise))((function(n,s){function i(e){try{c(t.next(e))}catch(e){s(e)}}function l(e){try{c(t.throw(e))}catch(e){s(e)}}function c(e){var r;e.done?n(e.value):(r=e.value,r instanceof a?r:new a((function(e){e(r)}))).then(i,l)}c((t=t.apply(e,r||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.revealUsernameRejectCallbackQuery=void 0;const postgres_1=require("../db/postgres"),i18n_1=require("../i18n"),revealUsernameRejectCallbackQuery=e=>__awaiter(void 0,void 0,void 0,(function*(){const r=e.callbackQuery,a=r.data,t=String(r.from.id),n=a.split(":")[1];e.logger.info({currentUserId:t,requestingUserId:n,callbackType:"reveal_username_reject",action:"username_reveal_rejected"},"User rejected username reveal request"),yield e.answerCallbackQuery({text:e.t("roulette_reveal_username_rejected"),show_alert:!1}),r.message&&(yield e.api.editMessageText(r.message.chat.id,r.message.message_id,e.t("roulette_reveal_username_rejected"),{reply_markup:{inline_keyboard:[]}}));const s=yield postgres_1.prisma.session.findUnique({where:{key:n}}),{__language_code:i}=s?JSON.parse(s.value):{};e.logger.info({currentUserId:t,requestingUserId:n,language:i||"ru"},"Sending username reveal rejection notification"),yield e.api.sendMessage(n,(0,i18n_1.i18n)(!1).t(i||"ru","roulette_reveal_rejected_message"))}));exports.revealUsernameRejectCallbackQuery=revealUsernameRejectCallbackQuery;