"use strict";var __awaiter=this&&this.__awaiter||function(e,r,a,t){return new(a||(a=Promise))((function(o,l){function i(e){try{s(t.next(e))}catch(e){l(e)}}function n(e){try{s(t.throw(e))}catch(e){l(e)}}function s(e){var r;e.done?o(e.value):(r=e.value,r instanceof a?r:new a((function(e){e(r)}))).then(i,n)}s((t=t.apply(e,r||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.complainReasonCallbackQuery=void 0;const postgres_1=require("../db/postgres"),logger_1=require("../logger"),complainReasonCallbackQuery=e=>__awaiter(void 0,void 0,void 0,(function*(){var r,a,t,o;logger_1.logger.info({userId:null===(r=e.from)||void 0===r?void 0:r.id,reason:null===(a=e.callbackQuery)||void 0===a?void 0:a.data},"User selected complaint reason");const l=e.callbackQuery.data.split(":"),i=l[1],n=l[2],s=String(null===(t=e.callbackQuery)||void 0===t?void 0:t.from.id),c={1:"adult_content",2:"sale",3:"fake",4:"advertising",5:"scam",6:"dislike",7:"other"}[i];try{if(yield postgres_1.prisma.report.findFirst({where:{reporterId:s,targetId:n}}))return void(yield e.answerCallbackQuery({text:e.t("you_already_sent_complain_to_this_user"),show_alert:!0}));yield postgres_1.prisma.report.create({data:{reporterId:s,targetId:n,type:c,text:""}}),(null===(o=e.callbackQuery)||void 0===o?void 0:o.message)&&(yield e.api.editMessageText(e.callbackQuery.message.chat.id,e.callbackQuery.message.message_id,e.t("complain_will_be_examined"),{reply_markup:{inline_keyboard:[]}})),yield e.answerCallbackQuery({text:e.t("complain_will_be_examined"),show_alert:!1})}catch(r){e.logger.error({error:r,action:"Error handling complaint reason",fromUserId:s,targetUserId:n,reasonId:i}),yield e.answerCallbackQuery({text:e.t("error_occurred"),show_alert:!0})}}));exports.complainReasonCallbackQuery=complainReasonCallbackQuery;