"use strict";var __awaiter=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function d(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,d)}s((r=r.apply(e,n||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.checkForBanMiddleware=void 0;const postgres_1=require("../db/postgres"),date_fns_1=require("date-fns"),checkForBanMiddleware=(e,n)=>__awaiter(void 0,void 0,void 0,(function*(){var t;if(e.inlineQuery)return void(yield n());const r=String(null===(t=e.from)||void 0===t?void 0:t.id),i=new Date,a=yield postgres_1.prisma.userBan.findFirst({where:{userId:r,isActive:!0,bannedUntil:{gt:i}}});if(a){const n=(0,date_fns_1.format)(a.bannedUntil,"d MMMM yyyy 'Ð²' HH:mm");let t="";return t+=a.bannedUntil.getFullYear()>2100?e.t("user_banned_permanent")+"\n\n":e.t("user_banned_until",{date:n})+"\n\n",a.reason&&(t+="\n\n"+e.t("user_banned_reason",{reason:a.reason})),void(yield e.reply(t))}yield n()}));exports.checkForBanMiddleware=checkForBanMiddleware;