"use strict";var __awaiter=this&&this.__awaiter||function(e,i,s,r){return new(s||(s=Promise))((function(t,n){function o(e){try{d(r.next(e))}catch(e){n(e)}}function c(e){try{d(r.throw(e))}catch(e){n(e)}}function d(e){var i;e.done?t(e.value):(i=e.value,i instanceof s?i:new s((function(e){e(i)}))).then(o,c)}d((r=r.apply(e,i||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.checkSubscriptionMiddleware=void 0;const keyboards_1=require("../constants/keyboards"),checkSubscription_1=require("../functions/checkSubscription"),checkSubscriptionMiddleware=(e,i)=>__awaiter(void 0,void 0,void 0,(function*(){var s,r;if((null===(r=null===(s=e.message)||void 0===s?void 0:s.text)||void 0===r?void 0:r.startsWith("/start"))||"choose_language_start"===e.session.step)return e.session.isNeededSubscription=!1,void(yield i());(yield(0,checkSubscription_1.checkSubscription)(e,String(process.env.CHANNEL_NAME)))?(e.session.isNeededSubscription&&(yield e.reply(e.t("thanks_for_subscription"),{reply_markup:{remove_keyboard:!0}})),e.session.isNeededSubscription=!1,yield i()):(e.session.isNeededSubscription=!0,yield e.reply(e.t("need_subscription"),{reply_markup:(0,keyboards_1.subscribeChannelKeyboard)(e.t),parse_mode:"Markdown"}))}));exports.checkSubscriptionMiddleware=checkSubscriptionMiddleware;