"use strict";var __awaiter=this&&this.__awaiter||function(e,r,i,s){return new(i||(i=Promise))((function(o,n){function t(e){try{l(s.next(e))}catch(e){n(e)}}function a(e){try{l(s.throw(e))}catch(e){n(e)}}function l(e){var r;e.done?o(e.value):(r=e.value,r instanceof i?r:new i((function(e){e(r)}))).then(t,a)}l((s=s.apply(e,r||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.myprofileCommand=void 0;const keyboards_1=require("./../constants/keyboards"),keyboards_2=require("../constants/keyboards"),postgres_1=require("../db/postgres"),sendForm_1=require("../functions/sendForm"),restoreProfileValues_1=require("../functions/restoreProfileValues"),myprofileCommand=e=>__awaiter(void 0,void 0,void 0,(function*(){var r,i;const s=String(null===(r=e.message)||void 0===r?void 0:r.from.id);e.logger.info({userId:s,username:null===(i=e.from)||void 0===i?void 0:i.username,isEditingProfile:e.session.isEditingProfile,privacyAccepted:e.session.privacyAccepted},"Processing myprofile command");(yield postgres_1.prisma.user.findUnique({where:{id:s}}))?(e.session.isEditingProfile&&(e.session.isEditingProfile=!1,e.logger.info({userId:s,action:"restore_profile"},"Restoring profile values"),yield(0,restoreProfileValues_1.restoreProfileValues)(e)),e.session.step="profile",e.logger.info({userId:s,step:e.session.step},"Sending profile for existing user"),yield(0,sendForm_1.sendForm)(e),yield e.reply(e.t("profile_menu"),{reply_markup:(0,keyboards_2.profileKeyboard)()})):e.session.privacyAccepted?(e.session.step="create_profile_type",e.session.isCreatingProfile=!0,e.logger.info({userId:s,step:e.session.step},"Starting profile creation for new user"),yield e.reply(e.t("profile_type_title"),{reply_markup:(0,keyboards_1.createProfileTypeKeyboard)(e.t)})):(e.session.step="accept_privacy",e.logger.info({userId:s,step:e.session.step},"Showing privacy policy for new user"),yield e.reply(e.t("privacy_message"),{reply_markup:(0,keyboards_2.acceptPrivacyKeyboard)(e.t)}))}));exports.myprofileCommand=myprofileCommand;