"use strict";var __awaiter=this&&this.__awaiter||function(e,o,r,i){return new(r||(r=Promise))((function(n,s){function t(e){try{a(i.next(e))}catch(e){s(e)}}function d(e){try{a(i.throw(e))}catch(e){s(e)}}function a(e){var o;e.done?n(e.value):(o=e.value,o instanceof r?o:new r((function(e){e(o)}))).then(t,d)}a((i=i.apply(e,o||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.newLikesCommand=void 0;const keyboards_1=require("./../constants/keyboards"),postgres_1=require("../db/postgres"),getOneLike_1=require("../functions/db/getOneLike"),sendForm_1=require("../functions/sendForm"),newLikesCommand=e=>__awaiter(void 0,void 0,void 0,(function*(){var o,r;const i=String(null===(o=e.message)||void 0===o?void 0:o.from.id);e.logger.info({userId:i},"Starting new likes command");if(yield postgres_1.prisma.user.findUnique({where:{id:i}})){const o=yield(0,getOneLike_1.getOneLike)(i,"user");o?(e.logger.info({userId:i,fromProfileId:null===(r=o.fromProfile)||void 0===r?void 0:r.id},"Found new like"),e.session.step="search_people_with_likes",e.session.additionalFormInfo.searchingLikes=!0,e.session.currentCandidateProfile=null==o?void 0:o.fromProfile,yield e.reply("‚ú®üîç",{reply_markup:(0,keyboards_1.answerLikesFormKeyboard)()}),(null==o?void 0:o.fromProfile)&&(yield(0,sendForm_1.sendForm)(e,o.fromProfile.user,{myForm:!1,like:o}))):(e.logger.info({userId:i},"No new likes found"),yield e.reply(e.t("no_new_likes"),{reply_markup:(0,keyboards_1.notHaveFormToDeactiveKeyboard)(e.t)}),e.session.step="sleep_menu",yield e.reply(e.t("sleep_menu"),{reply_markup:(0,keyboards_1.profileKeyboard)()}))}else e.session.step="you_dont_have_form",e.logger.warn({userId:i},"User tried to check likes without profile"),yield e.reply(e.t("you_dont_have_form"),{reply_markup:(0,keyboards_1.notHaveFormToDeactiveKeyboard)(e.t)})}));exports.newLikesCommand=newLikesCommand;