"use strict";var __awaiter=this&&this.__awaiter||function(e,t,s,i){return new(s||(s=Promise))((function(r,n){function u(e){try{a(i.next(e))}catch(e){n(e)}}function o(e){try{a(i.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(u,o)}a((i=i.apply(e,t||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.mutualSympathiesStep=mutualSympathiesStep;const keyboards_1=require("../constants/keyboards"),postgres_1=require("../db/postgres"),sendForm_1=require("../functions/sendForm");function mutualSympathiesStep(e){return __awaiter(this,void 0,void 0,(function*(){var t;const s=e.message.text;if("üíù –í–∑–∞–∏–º–Ω—ã–µ —Å–∏–º–ø–∞—Ç–∏–∏"===s){const s=String(null===(t=e.message)||void 0===t?void 0:t.from.id),i=yield postgres_1.prisma.userLike.findMany({where:{userId:s,liked:!0,isMutual:!0},include:{target:!0},orderBy:{createdAt:"desc"}});if(0===i.length)return void(yield e.reply(e.t("no_mutual_sympathies")));const r=i[0];e.session.currentMutualLike=r,e.session.mutualLikes=i,e.session.currentMutualLikeIndex=0,yield(0,sendForm_1.sendForm)(e,r.target,{myForm:!1,isMutualSympathy:!0,mutualLikeCount:i.length}),yield e.reply(e.t("mutual_sympathies_navigation"),{reply_markup:{keyboard:[["‚¨ÖÔ∏è","‚û°Ô∏è"],[e.t("back_to_profile")]],resize_keyboard:!0}})}else if("‚¨ÖÔ∏è"===s||"‚û°Ô∏è"===s){if(!e.session.mutualLikes||!e.session.currentMutualLikeIndex)return void(yield e.reply(e.t("error_occurred")));const t="‚û°Ô∏è"===s?1:-1,i=(e.session.currentMutualLikeIndex+t+e.session.mutualLikes.length)%e.session.mutualLikes.length;e.session.currentMutualLikeIndex=i,e.session.currentMutualLike=e.session.mutualLikes[i],yield(0,sendForm_1.sendForm)(e,e.session.currentMutualLike.target,{myForm:!1,isMutualSympathy:!0,mutualLikeCount:e.session.mutualLikes.length})}else s===e.t("back_to_profile")?(e.session.step="profile",e.session.currentMutualLike=null,e.session.mutualLikes=null,e.session.currentMutualLikeIndex=null,yield e.reply(e.t("profile_menu"),{reply_markup:(0,keyboards_1.profileKeyboard)()})):yield e.reply(e.t("no_such_answer"))}))}