"use strict";var __awaiter=this&&this.__awaiter||function(e,o,i,r){return new(i||(i=Promise))((function(s,n){function t(e){try{a(r.next(e))}catch(e){n(e)}}function d(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var o;e.done?s(e.value):(o=e.value,o instanceof i?o:new i((function(e){e(o)}))).then(t,d)}a((r=r.apply(e,o||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.somebodysLikedYouStep=somebodysLikedYouStep;const keyboards_1=require("../constants/keyboards"),getOneLike_1=require("../functions/db/getOneLike"),profilesService_1=require("../functions/db/profilesService"),sendForm_1=require("../functions/sendForm");function somebodysLikedYouStep(e){return __awaiter(this,void 0,void 0,(function*(){const o=e.message.text,i=String(e.from.id);if(e.logger.info({userId:i},"Processing likes notification"),"1 üëç"===o){e.session.step="search_people_with_likes",e.session.additionalFormInfo.searchingLikes=!0;const o=yield(0,getOneLike_1.getOneLike)(i,"user");e.session.currentCandidateProfile=null==o?void 0:o.fromProfile,yield e.reply("‚ú®üîç",{reply_markup:(0,keyboards_1.answerLikesFormKeyboard)()}),(null==o?void 0:o.fromProfile)&&(yield(0,sendForm_1.sendForm)(e,o.fromProfile.user,{myForm:!1,like:o}),e.logger.info({userId:i,likesCount:1},"Sent likes notification"))}else if("2 üí§"===o){e.session.step="disable_form";const o=yield(0,profilesService_1.getUserProfiles)(i,e);yield e.reply(e.t("are_you_sure_you_want_to_disable_your_form"),{reply_markup:(0,keyboards_1.deactivateProfileKeyboard)(e.t,o)})}else yield e.reply(e.t("no_such_answer"),{reply_markup:(0,keyboards_1.somebodysLikedYouKeyboard)()})}))}