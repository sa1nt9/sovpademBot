"use strict";var __awaiter=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(n,a){function i(e){try{s(o.next(e))}catch(e){a(e)}}function d(e){try{s(o.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,d)}s((o=o.apply(e,t||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.addPrivateNoteStep=addPrivateNoteStep;const keyboards_1=require("../constants/keyboards");function addPrivateNoteStep(e){return __awaiter(this,void 0,void 0,(function*(){var t;const r=e.message.text,o=String(e.from.id),n=null===(t=e.session.currentCandidateProfile)||void 0===t?void 0:t.id;return e.logger.info({userId:o,step:"add_private_note",candidateId:n},"User adding private note to like"),r===e.t("back")?(e.logger.info({userId:o},"User cancelled private note creation"),e.session.step="text_or_video_to_user",void(yield e.reply(e.t("text_or_video_to_user"),{reply_markup:(0,keyboards_1.textOrVideoKeyboard)(e.t)}))):r&&r.length>400?(e.logger.warn({userId:o,messageLength:r.length},"Private note too long"),void(yield e.reply(e.t("private_note_max_length")))):void(r?(e.logger.info({userId:o,candidateId:n,noteLength:r.length},"User successfully added private note"),e.session.privateNote=r,e.session.step="added_private_note",yield e.reply(e.t("after_note_you_want_to_add_text_to_user"),{reply_markup:(0,keyboards_1.skipKeyboard)(e.t,!0),parse_mode:"Markdown"})):(e.logger.warn({userId:o},"User sent empty message for private note"),yield e.reply(e.t("write_text_note"),{reply_markup:(0,keyboards_1.goBackKeyboard)(e.t)})))}))}