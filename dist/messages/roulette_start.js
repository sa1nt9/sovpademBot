"use strict";var __awaiter=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(s,i){function n(e){try{u(o.next(e))}catch(e){i(e)}}function a(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,a)}u((o=o.apply(e,t||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.rouletteStartStep=void 0,exports.showRouletteStart=showRouletteStart;const keyboards_1=require("../constants/keyboards"),postgres_1=require("../db/postgres"),findRouletteUser_1=require("../functions/findRouletteUser"),getUserReactions_1=require("../functions/getUserReactions"),sendForm_1=require("../functions/sendForm"),rouletteStartStep=e=>__awaiter(void 0,void 0,void 0,(function*(){var t;const r=e.message.text,o=String(null===(t=e.message)||void 0===t?void 0:t.from.id);if(e.logger.info({userId:o},"Starting roulette step"),r===e.t("main_menu"))e.session.step="profile",yield(0,sendForm_1.sendForm)(e),yield e.reply(e.t("profile_menu"),{reply_markup:(0,keyboards_1.profileKeyboard)()});else if(r===e.t("roulette_find")){e.session.step="roulette_searching";(yield postgres_1.prisma.user.findUnique({where:{id:o}}))?(e.logger.info({userId:o},"Found existing user, starting roulette search"),yield(0,findRouletteUser_1.findRouletteUser)(e)):(e.logger.info({userId:o},"User not found, redirecting to form creation"),e.session.step="you_dont_have_form",yield e.reply(e.t("you_dont_have_form"),{reply_markup:(0,keyboards_1.profileKeyboard)()}))}else yield e.reply(e.t("no_such_answer"),{reply_markup:(0,keyboards_1.rouletteStartKeyboard)(e.t)})}));function showRouletteStart(e){return __awaiter(this,void 0,void 0,(function*(){var t;const r=String(null===(t=e.from)||void 0===t?void 0:t.id);e.logger.info({userId:r},"Showing roulette start screen");const o=yield(0,getUserReactions_1.getUserReactions)(e,r,{me:!0,showTitle:!0});let s;s=o?e.t("roulette_start",{reactions:`\n${o}\n`}):e.t("roulette_start",{reactions:""}),yield e.reply(s,{reply_markup:(0,keyboards_1.rouletteStartKeyboard)(e.t)})}))}exports.rouletteStartStep=rouletteStartStep;