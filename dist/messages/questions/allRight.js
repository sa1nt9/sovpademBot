"use strict";var __awaiter=this&&this.__awaiter||function(e,i,t,n){return new(t||(t=Promise))((function(r,o){function a(e){try{s(n.next(e))}catch(e){o(e)}}function d(e){try{s(n.throw(e))}catch(e){o(e)}}function s(e){var i;e.done?r(e.value):(i=e.value,i instanceof t?i:new t((function(e){e(i)}))).then(a,d)}s((n=n.apply(e,i||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.allRightQuestion=void 0;const keyboards_1=require("../../constants/keyboards"),getCandidate_1=require("../../functions/db/getCandidate"),sendForm_1=require("../../functions/sendForm"),candidatesEnded_1=require("../../functions/candidatesEnded"),startSearchingPeople_1=require("../../functions/startSearchingPeople"),allRightQuestion=e=>__awaiter(void 0,void 0,void 0,(function*(){var i;const t=e.message.text,n=String(e.from.id);if(e.logger.info({userId:n,question:"all_right",input:t,profileType:null===(i=e.session.activeProfile)||void 0===i?void 0:i.profileType},"User at final profile confirmation stage"),t===e.t("yes")){e.logger.info({userId:n},"User confirmed profile and ready to browse matches"),yield(0,startSearchingPeople_1.startSearchingPeople)(e,{setActive:!0});const i=yield(0,getCandidate_1.getCandidate)(e);e.logger.info({userId:n,candidateId:null==i?void 0:i.id},"First candidate after profile completion"),i?yield(0,sendForm_1.sendForm)(e,i||null,{myForm:!1}):(e.logger.info({userId:n},"No candidates available after profile completion"),yield(0,candidatesEnded_1.candidatesEnded)(e))}else t===e.t("change_form")?(e.logger.info({userId:n},"User wants to change profile before browsing"),e.session.step="profile",yield e.reply(e.t("profile_menu"),{reply_markup:(0,keyboards_1.profileKeyboard)()})):(e.logger.warn({userId:n,invalidOption:t},"User provided invalid response at confirmation"),yield e.reply(e.t("no_such_answer"),{reply_markup:(0,keyboards_1.allRightKeyboard)(e.t)}))}));exports.allRightQuestion=allRightQuestion;