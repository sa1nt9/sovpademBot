"use strict";var __awaiter=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(n,i){function a(e){try{d(o.next(e))}catch(e){i(e)}}function s(e){try{d(o.throw(e))}catch(e){i(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}d((o=o.apply(e,t||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.saveForm=saveForm;const postgres_1=require("../../db/postgres");function saveForm(e){return __awaiter(this,void 0,void 0,(function*(){var t;try{const r=e.session.activeProfile,o=String(null===(t=e.message)||void 0===t?void 0:t.from.id);if(yield postgres_1.prisma.user.findUnique({where:{id:o}})){const t=yield postgres_1.prisma.user.update({where:{id:o},data:{name:r.name||"",city:r.city||"",gender:r.gender||"",age:r.age||0,longitude:r.location.longitude,latitude:r.location.latitude,ownCoordinates:r.ownCoordinates}});return e.logger.info({msg:"Пользователь обновлен",updatedUser:t}),t}{const t=yield postgres_1.prisma.user.create({data:{id:o,name:r.name||"",city:r.city||"",gender:r.gender||"",age:r.age||0,longitude:r.location.longitude,referrerId:e.session.referrerId||"",latitude:r.location.latitude,ownCoordinates:r.ownCoordinates}});return e.logger.info({msg:"Новый пользователь сохранен",newUser:t}),t}}catch(t){e.logger.error({msg:"Ошибка при сохранении пользователя",error:t})}}))}