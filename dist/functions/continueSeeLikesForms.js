"use strict";var __awaiter=this&&this.__awaiter||function(e,n,i,o){return new(i||(i=Promise))((function(r,s){function t(e){try{l(o.next(e))}catch(e){s(e)}}function u(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var n;e.done?r(e.value):(n=e.value,n instanceof i?n:new i((function(e){e(n)}))).then(t,u)}l((o=o.apply(e,n||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.continueSeeLikesForms=void 0;const keyboards_1=require("../constants/keyboards"),getOneLike_1=require("./db/getOneLike"),sendForm_1=require("./sendForm"),sendMutualSympathyAfterAnswer_1=require("./sendMutualSympathyAfterAnswer"),continueSeeLikesForms=e=>__awaiter(void 0,void 0,void 0,(function*(){const n=String(e.from.id);e.logger.info({userId:n},"Continuing to see likes forms");const i=yield(0,getOneLike_1.getOneLike)(n,"user");if(null==i?void 0:i.fromProfile){if(e.session.pendingMutualLike&&e.session.pendingMutualLikeProfileId)return e.logger.info({userId:n},"Processing pending mutual like"),yield(0,sendMutualSympathyAfterAnswer_1.sendMutualSympathyAfterAnswer)(e,{withoutSleepMenu:!0}),void(e.session.step="continue_see_likes_forms");e.logger.info({userId:n,fromProfileId:i.fromProfile.id},"Showing like form"),yield e.reply("‚ú®üîç",{reply_markup:(0,keyboards_1.answerLikesFormKeyboard)()}),e.session.currentCandidateProfile=i.fromProfile,yield(0,sendForm_1.sendForm)(e,i.fromProfile,{myForm:!1,like:i})}else e.session.pendingMutualLike&&e.session.pendingMutualLikeProfileId&&(e.logger.info({userId:n},"Processing pending mutual like"),yield(0,sendMutualSympathyAfterAnswer_1.sendMutualSympathyAfterAnswer)(e,{withoutSleepMenu:!0})),e.logger.info({userId:n},"No more likes to show"),e.session.step="continue_see_forms",e.session.additionalFormInfo.searchingLikes=!1,yield e.reply(e.t("its_all_go_next_question"),{reply_markup:(0,keyboards_1.continueKeyboard)(e.t)})}));exports.continueSeeLikesForms=continueSeeLikesForms;