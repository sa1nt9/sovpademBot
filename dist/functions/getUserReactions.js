"use strict";var __awaiter=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(n,s){function i(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,a)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getUserReactions=getUserReactions;const postgres_1=require("../db/postgres"),reaction_1=require("../constants/reaction");function getUserReactions(e,t){return __awaiter(this,arguments,void 0,(function*(e,t,o={}){e.logger.info({userId:t,me:o.me,showTitle:o.showTitle},"Getting user reactions");const r=yield postgres_1.prisma.rouletteReaction.findMany({where:{toUserId:t}});if(0===r.length)return e.logger.info({userId:t},"No reactions found for user"),"";e.logger.info({userId:t,reactionsCount:r.length},"Found user reactions");const n={};reaction_1.REACTIONS.forEach((e=>{n[e.type]=0})),r.forEach((e=>{n[e.type]++}));let s="";o.showTitle&&(s=o.me?e.t("roulette_your_reactions")+" ":e.t("roulette_user_reactions")+" ");let i=!1;for(const t of reaction_1.REACTIONS){const o=n[t.type];if(o>0){const r=`roulette_reaction_${t.type.toLowerCase()}`;i&&(s+=" "),s+=e.t(r,{count:o}),i=!0}}return i?(e.logger.info({userId:t,messageLength:s.length},"Generated reactions message"),s):(e.logger.info({userId:t},"No reactions to display"),"")}))}